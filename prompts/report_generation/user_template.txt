{{MANDATORY_RECIPES_SECTION}}

## 중요 컨텍스트

**질환 필터링:**
- 데이터는 질환 **이름** (예: '고혈압')으로 필터링해야 합니다
- `res_disease_name` 컬럼 사용 (질환 코드 아님)
- 실행 환경: Databricks/Spark SQL

{{DATABRICKS_RULES}}

{{SCHEMA_INFO}}

## 사용자 요청

```
{{USER_QUERY}}
```

## 사용 가능한 분석 레시피

{{RECIPE_LIST}}

## 작업 지시사항

다음 단계를 순차적으로 수행하세요:

### 1단계: 사용자 의도 분석
- 요청이 "임상시험 타당성 보고서"인지 "시장 분석 보고서"인지 판단
- 핵심 질환, 대상 환자군, 분석 목적 식별

### 2단계: 전략적 내러티브 구성
- 보고서 유형에 맞는 논리적 스토리라인 설계
- 각 분석이 어떻게 최종 의사결정으로 이어지는지 구조화

### 3단계: 레시피 선택 (3~5개)
- 내러티브에 가장 적합한 레시피를 선택
- **필수 레시피가 제공된 경우 반드시 포함**
- 분석 순서가 논리적으로 연결되도록 배치

### 4단계: 파라미터 추출
사용자 쿼리에서 각 레시피에 필요한 파라미터를 추출합니다.

**파라미터 추출 규칙:**
- 쿼리에 명시된 값만 사용
- 값이 없으면 다음 플레이스홀더 사용:
  - `[NOT_FOUND]` - 정보 없음
  - `[DEFAULT_3_YEARS_AGO]` - 3년 전 날짜 (시작일)
  - `[CURRENT_DATE]` - 현재 날짜 (종료일)
  - `[DEFAULT_50]` - 기본 상위 N개 (top_n)
  - `[DEFAULT_200]` - 기본 목표 모집 인원

**파라미터 예시:**
```
쿼리: "고혈압 환자 중 60세 이상 분석"
→ disease_name_keyword: "고혈압"
→ min_age: 60
→ max_age: [NOT_FOUND]
```

### 5단계: 보고서 구성요소 생성

다음 요소를 작성하세요:

1. **report_title** (보고서 제목)
   - 핵심 질환 + 보고서 유형 명시
   - 간결하고 전문적 (15자 이내 권장)

2. **executive_summary** (요약)
   - 보고서의 목적과 범위를 2~3문장으로 설명
   - 예상되는 인사이트 또는 활용 방안 언급

3. **table_of_contents** (목차)
   - 각 페이지의 제목을 순서대로 나열
   - 형식: "1. 제목", "2. 제목", ...

4. **pages** (각 분석 페이지)
   - **title**: 페이지 제목 (목차와 일치)
   - **rationale**: 이 분석이 왜 중요한지, 어떤 의사결정에 기여하는지 설명 (2~3문장)
   - **recipe_name**: 레시피 이름 (제공된 목록과 정확히 일치)
   - **parameters**: 추출된 파라미터 (JSON 객체)

{{OUTPUT_VALIDATION}}

## 출력 형식

JSON 객체만 반환하세요 (코드 블록이나 설명 없이):

```json
{
  "report_title": "보고서 제목",
  "executive_summary": "보고서 요약 (2-3문장)",
  "table_of_contents": [
    "1. 첫 번째 분석 제목",
    "2. 두 번째 분석 제목",
    ...
  ],
  "pages": [
    {
      "title": "1. 첫 번째 분석 제목",
      "rationale": "이 분석의 중요성과 기여도 설명",
      "recipe_name": "정확한_레시피_이름",
      "parameters": {
        "param1": "value1",
        "param2": 123
      }
    },
    ...
  ]
}
```

**중요:** 레시피 이름과 파라미터 이름은 제공된 목록과 **정확히 일치**해야 합니다.

{{EXAMPLES}}
